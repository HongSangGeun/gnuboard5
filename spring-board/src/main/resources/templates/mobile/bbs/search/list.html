<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <link rel="stylesheet" th:href="@{/js/font-awesome/css/font-awesome.min.css}">
    <link rel="stylesheet" th:href="@{/css/default.css}">
    <link rel="stylesheet" th:href="@{/css/mobile-layout.css}">
    <link rel="stylesheet" th:href="@{/css/mobile.css}">
    <link rel="stylesheet" th:href="@{/css/mobile-board-skin.css}">
    <title>전체검색 결과</title>
</head>

<body>
    <div th:replace="~{fragments/nav :: nav}"></div>
    <div id="wrapper">
        <div id="container_wr">
            <div id="container" class="m_container">
                <!-- Header -->
                <div class="m_header_title"
                    style="display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
                    <h1 id="container_title" style="margin: 0; font-size: 1.2rem; font-weight: 700;">통합검색</h1>
                </div>

                <!-- Search Input Form -->
                <div class="m_sch_wrap">
                    <form id="fsearch" method="get" th:action="@{/bbs/search}">
                        <input type="hidden" name="srows" value="10">
                        <div class="m_sch_input_group">
                            <input type="text" name="stx" id="stx" required class="m_sch_input" placeholder="검색어를 입력하세요"
                                th:value="${textStx}">
                            <button type="submit" class="m_sch_btn"><i class="fa fa-search"
                                    aria-hidden="true"></i></button>
                        </div>
                    </form>
                </div>

                <!-- Board Tabs -->
                <div class="m_sch_tabs" th:if="${textStx != null and textStx != '' and boardCount > 0}">
                    <a th:href="@{/bbs/search(stx=${textStx}, sfl=${sfl}, sop=${sop}, srows=${srows}, gr_id=${grId}, page=1)}"
                        class="m_sch_tab_item"
                        th:classappend="${onetable == null || onetable == ''} ? 'active' : ''">전체</a>

                    <a th:each="tab : ${boardTabs}"
                        th:href="@{/bbs/search(stx=${textStx}, sfl=${sfl}, sop=${sop}, srows=${srows}, gr_id=${grId}, onetable=${tab.boTable}, page=1)}"
                        class="m_sch_tab_item" th:classappend="${onetable == tab.boTable} ? 'active' : ''">
                        <span th:text="${tab.boSubject}">게시판</span>
                        <span th:text="${tab.count}" style="margin-left: 2px; opacity: 0.8; font-size: 0.9em;">0</span>
                    </a>
                </div>

                <!-- Search Results Info -->
                <div class="m_sch_result_info" th:if="${textStx != null and textStx != '' and boardCount > 0}">
                    <span style="font-weight: 700; color: #333;" th:text="'\'' + ${textStx} + '\''">검색어</span> 검색 결과
                    <span th:text="${totalCount}">0</span>건
                </div>

                <!-- Empty State -->
                <div class="m_sch_empty" th:if="${textStx != null and textStx != '' and boardCount == 0}">
                    <i class="fa fa-exclamation-circle" aria-hidden="true"
                        style="font-size: 2rem; color: #ddd; margin-bottom: 10px; display: block;"></i>
                    검색된 자료가 없습니다.
                </div>

                <!-- Search Results List -->
                <div class="m_post_list" th:if="${textStx != null and textStx != '' and boardCount > 0}">
                    <div th:each="result : ${boardResults}">
                        <!-- Board Title for Grouped Results (Only show if 'All' tab is selected) -->
                        <div th:if="${onetable == null || onetable == ''}"
                            style="margin: 20px 0 10px 4px; font-weight: 700; font-size: 1.1rem; color: #333;">
                            <span th:text="${result.boSubject}">게시판명</span>
                            <a th:href="@{'/bbs/' + ${result.boTable} + '/list'(stx=${textStx})}"
                                style="float: right; font-size: 13px; color: #999; font-weight: normal; margin-top: 4px;">더보기
                                <i class="fa fa-angle-right"></i></a>
                        </div>

                        <a th:each="item : ${result.items}" th:href="@{${item.href}}" class="m_list_item_card">
                            <div class="m_list_subject" style="margin-bottom: 12px;">
                                <span th:if="${onetable != null && onetable != ''}"
                                    th:text="'[' + ${result.boSubject} + '] '"
                                    style="color: var(--primary-color); font-size: 0.9em; font-weight: normal;">[게시판]</span>
                                <span th:utext="${item.highlightedSubject}">제목</span>


                                <span th:if="${item.comment}"
                                    style="color: #ff5b5b; font-size: 0.9rem; margin-left: 4px;"><i
                                        class="fa fa-commenting-o"></i></span>
                            </div>
                            <div class="m_list_meta">
                                <span class="m_list_date" th:text="${item.wrDatetime}">2024-00-00</span>
                                <span class="m_list_writer" th:text="${item.writer}">작성자</span>
                            </div>
                            <div style="font-size: 13px; color: #666; margin-top: 10px; line-height: 1.4; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;"
                                th:text="${item.content}">본문내용</div>
                        </a>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination" th:if="${totalPage > 1}" style="margin-top: 20px;">
                    <a th:if="${hasPrevPage}"
                        th:href="@{/bbs/search(stx=${textStx}, sfl=${sfl}, sop=${sop}, srows=${srows}, gr_id=${grId}, onetable=${onetable}, page=${prevPage})}"
                        class="pg_page pg_prev"><i class="fa fa-chevron-left"></i></a>

                    <th:block th:each="p : ${pageNumbers}">
                        <span th:if="${p == currentPage}" class="pg_current"
                            style="background: var(--primary-color); color: #fff; width: 28px; height: 28px; line-height: 28px; border-radius: 50%; display: inline-block; text-align: center; font-size: 13px;"
                            th:text="${p}">1</span>
                        <a th:if="${p != currentPage}"
                            th:href="@{/bbs/search(stx=${textStx}, sfl=${sfl}, sop=${sop}, srows=${srows}, gr_id=${grId}, onetable=${onetable}, page=${p})}"
                            class="pg_page"
                            style="width: 28px; height: 28px; line-height: 28px; display: inline-block; text-align: center; color: #777; font-size: 13px;"
                            th:text="${p}">1</a>
                    </th:block>

                    <a th:if="${hasNextPage}"
                        th:href="@{/bbs/search(stx=${textStx}, sfl=${sfl}, sop=${sop}, srows=${srows}, gr_id=${grId}, onetable=${onetable}, page=${nextPage})}"
                        class="pg_page pg_next"><i class="fa fa-chevron-right"></i></a>
                </div>

            </div>
        </div>
    </div>
    <div th:replace="~{fragments/nav :: nav_end}"></div>
</body>

</html>