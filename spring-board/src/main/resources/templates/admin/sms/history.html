<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{admin/layout/layout}">

<head>
    <title>SMS 발송 이력</title>
</head>

<body>
    <div layout:fragment="content">

        <div class="local_desc">
            <p>SMS 발송 이력을 조회합니다.</p>
        </div>

        <div class="local_ov">
            <span class="btn_ov01">
                <span class="ov_txt">전체</span>
                <span class="ov_num" th:text="${totalCount}">0</span>
            </span>
        </div>

        <form name="fsearch" id="fsearch" method="get" th:action="@{/mgmt/sms/history}">
            <div class="local_sch">
                <label for="sfl" class="sound_only">검색대상</label>
                <select name="sfl" id="sfl">
                    <option value="hs_phone" th:selected="${sfl == 'hs_phone'}">수신번호</option>
                    <option value="hs_msg" th:selected="${sfl == 'hs_msg'}">메시지</option>
                </select>
                <label for="stx" class="sound_only">검색어</label>
                <input type="text" name="stx" th:value="${stx}" id="stx" class="frm_input">
                <button type="submit" class="btn_submit">검색</button>
            </div>
        </form>

        <div class="tbl_head01 tbl_wrap">
            <table>
                <caption>SMS 발송 이력 목록</caption>
                <thead>
                    <tr>
                        <th scope="col">번호</th>
                        <th scope="col">발신번호</th>
                        <th scope="col">수신번호</th>
                        <th scope="col">메시지</th>
                        <th scope="col">발송상태</th>
                        <th scope="col">발송일시</th>
                        <th scope="col">발송결과</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:if="${#lists.isEmpty(historyList)}">
                        <td colspan="7" class="empty_table">발송 이력이 없습니다.</td>
                    </tr>
                    <tr th:each="history, iterStat : ${historyList}">
                        <td th:text="${totalCount - ((currentPage - 1) * pageSize + iterStat.index)}">1</td>
                        <td th:text="${history.hsFromNumber}">02-1234-5678</td>
                        <td th:text="${history.hsToNumber}">010-1234-5678</td>
                        <td class="td_left">
                            <div style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                                 th:text="${history.hsMessage}">메시지 내용</div>
                        </td>
                        <td>
                            <span th:if="${history.hsStatus == 'SUCCESS'}" class="txt_true">성공</span>
                            <span th:if="${history.hsStatus == 'FAILED'}" class="txt_false">실패</span>
                            <span th:if="${history.hsStatus == 'PENDING'}" class="txt_pending">대기중</span>
                        </td>
                        <td th:text="${#temporals.format(history.hsSendDatetime, 'yyyy-MM-dd HH:mm:ss')}">2024-01-01 12:00:00</td>
                        <td th:text="${history.hsResult ?: '-'}">-</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 페이징 -->
        <div th:if="${totalPages > 0}" class="pagination">
            <a th:if="${currentPage > 1}"
               th:href="@{/mgmt/sms/history(page=${currentPage - 1}, sfl=${sfl}, stx=${stx})}"
               class="pg_page pg_prev">이전</a>

            <span th:each="pageNum : ${#numbers.sequence(startPage, endPage)}">
                <a th:if="${pageNum != currentPage}"
                   th:href="@{/mgmt/sms/history(page=${pageNum}, sfl=${sfl}, stx=${stx})}"
                   th:text="${pageNum}"
                   class="pg_page">1</a>
                <strong th:if="${pageNum == currentPage}"
                        th:text="${pageNum}"
                        class="pg_current">1</strong>
            </span>

            <a th:if="${currentPage < totalPages}"
               th:href="@{/mgmt/sms/history(page=${currentPage + 1}, sfl=${sfl}, stx=${stx})}"
               class="pg_page pg_next">다음</a>
        </div>

        <div class="btn_fixed_top">
            <a th:href="@{/mgmt/sms/config}" class="btn btn_02">환경설정</a>
            <a th:href="@{/mgmt/sms/test}" class="btn btn_03">테스트 발송</a>
        </div>

    </div>
</body>

</html>
