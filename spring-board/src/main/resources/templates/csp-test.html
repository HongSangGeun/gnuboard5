<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>CSP í…ŒìŠ¤íŠ¸ í˜ì´ì§€</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success {
            color: #22c55e;
        }
        .warning {
            color: #f59e0b;
        }
        h1 {
            color: #1f2937;
        }
        h2 {
            color: #4b5563;
            font-size: 1.2em;
            margin-top: 0;
        }
        pre {
            background: #1f2937;
            color: #f3f4f6;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .instruction {
            background: #fef3c7;
            padding: 15px;
            border-left: 4px solid #f59e0b;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ›¡ï¸ CSP (Content Security Policy) í…ŒìŠ¤íŠ¸</h1>

    <div class="instruction">
        <strong>ğŸ“Œ ì‚¬ìš© ë°©ë²•:</strong><br>
        1. <kbd>F12</kbd> í‚¤ë¥¼ ëˆŒëŸ¬ ê°œë°œì ë„êµ¬ë¥¼ ì—½ë‹ˆë‹¤<br>
        2. <strong>Console</strong> íƒ­ì„ í´ë¦­í•©ë‹ˆë‹¤<br>
        3. ì•„ë˜ ê²½ê³  ë©”ì‹œì§€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤
    </div>

    <div class="test-section">
        <h2>âœ… í…ŒìŠ¤íŠ¸ 1: í—ˆìš©ëœ ìŠ¤í¬ë¦½íŠ¸</h2>
        <p class="success">ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì •ìƒ ì‹¤í–‰ë©ë‹ˆë‹¤ (ê°™ì€ ë„ë©”ì¸)</p>
        <pre>ê²°ê³¼: <span id="test1">í…ŒìŠ¤íŠ¸ ì¤‘...</span></pre>
        <script th:attr="nonce=${cspNonce}">
            document.getElementById('test1').textContent = 'âœ“ ì„±ê³µ! (CSP í†µê³¼)';
        </script>
    </div>

    <div class="test-section">
        <h2>âš ï¸ í…ŒìŠ¤íŠ¸ 2: ì™¸ë¶€ CDN (í—ˆìš©ë¨)</h2>
        <p class="success">ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” CDNì€ í—ˆìš©ë©ë‹ˆë‹¤</p>
        <pre>ê²°ê³¼: <span id="test2">ë¡œë”© ì¤‘...</span></pre>
        <script th:src="'https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js'"></script>
        <script th:attr="nonce=${cspNonce}">
            if (typeof jQuery !== 'undefined') {
                document.getElementById('test2').textContent = 'âœ“ jQuery ë¡œë“œ ì„±ê³µ! (CDN í—ˆìš©ë¨)';
            } else {
                document.getElementById('test2').textContent = 'âœ— ì‹¤íŒ¨';
            }
        </script>
    </div>

    <div class="test-section">
        <h2>ğŸš« í…ŒìŠ¤íŠ¸ 3: ì°¨ë‹¨ë  ìŠ¤í¬ë¦½íŠ¸ (Report-Only)</h2>
        <p class="warning">ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” CSP ê²½ê³ ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤ (í˜„ì¬ëŠ” ì°¨ë‹¨ë˜ì§€ ì•ŠìŒ)</p>
        <p><small>âš ï¸ Consoleì—ì„œ ê²½ê³  ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”</small></p>
        <pre>ì˜ˆìƒ ê²½ê³ :
[Report Only] Refused to load the script
'https://evil-example.com/script.js'
because it violates the CSP directive</pre>
        <pre>ê²°ê³¼: <span id="test3-result">í…ŒìŠ¤íŠ¸ ì¤‘...</span></pre>
        <script th:attr="nonce=${cspNonce}">
            // í—ˆìš©ë˜ì§€ ì•Šì€ ë„ë©”ì¸ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹œë„
            var script = document.createElement('script');
            script.src = 'https://example.com/nonexistent.js';
            document.head.appendChild(script);
            // CSP Report-Only ê²½ê³ ê°€ ë°œìƒ
            document.getElementById('test3-result').textContent = 'âš ï¸ Console íƒ­ì—ì„œ CSP ê²½ê³ ë¥¼ í™•ì¸í•˜ì„¸ìš”';
        </script>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š í˜„ì¬ CSP ì •ì±…</h2>
        <pre id="csp-policy">ë¡œë”© ì¤‘...</pre>
        <script th:attr="nonce=${cspNonce}">
            // í˜„ì¬ í˜ì´ì§€ì˜ CSP ì •ì±… í‘œì‹œ
            var cspMeta = document.querySelector('meta[http-equiv="Content-Security-Policy"]');
            if (cspMeta) {
                document.getElementById('csp-policy').textContent = cspMeta.content;
            } else {
                document.getElementById('csp-policy').textContent =
                    'HTTP í—¤ë”ë¡œ ì„¤ì •ë¨ (F12 > Network > ì‘ë‹µ í—¤ë” í™•ì¸)';
            }
        </script>
    </div>

    <div class="test-section">
        <h2>ğŸ” CSP ê²½ê³  í™•ì¸ ë°©ë²•</h2>
        <ol>
            <li><strong>ë¸Œë¼ìš°ì € ì½˜ì†”:</strong> F12 > Console íƒ­</li>
            <li><strong>ë„¤íŠ¸ì›Œí¬ í—¤ë”:</strong> F12 > Network > ì‘ë‹µ í—¤ë”ì—ì„œ "Content-Security-Policy-Report-Only" í™•ì¸</li>
            <li><strong>ì„œë²„ ë¡œê·¸:</strong>
                <pre>docker logs spring-board -f | grep "CSP Violation"</pre>
            </li>
        </ol>
    </div>

    <div class="test-section">
        <h2>ğŸ’¡ ê²½ê³  ì˜ˆì‹œ</h2>
        <p>Consoleì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ë©”ì‹œì§€ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
        <pre style="color: #f59e0b; background: #fffbeb;">
[Report Only] Refused to load the script
'https://example.com/script.js' because it
violates the following Content Security Policy
directive: "script-src 'self' 'unsafe-inline'
https://cdn.jsdelivr.net https://t1.daumcdn.net".</pre>
    </div>

    <div style="margin-top: 40px; padding: 20px; background: #e0f2fe; border-radius: 8px;">
        <h3>âœ… ì •ìƒ ì‘ë™ í™•ì¸</h3>
        <p>ë§Œì•½ Consoleì— CSP ê²½ê³ ê°€ <strong>ì—†ë‹¤ë©´</strong>:</p>
        <ul>
            <li>âœ“ ëª¨ë“  ë¦¬ì†ŒìŠ¤ê°€ í—ˆìš©ëœ ë²”ìœ„ ë‚´ì— ìˆìŠµë‹ˆë‹¤</li>
            <li>âœ“ CSPê°€ ì˜¬ë°”ë¥´ê²Œ êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤</li>
            <li>âœ“ ì‹¤ì œ ì°¨ë‹¨ ëª¨ë“œë¡œ ì „í™˜í•´ë„ ì•ˆì „í•©ë‹ˆë‹¤</li>
        </ul>
    </div>

    <div style="margin-top: 20px; text-align: center;">
        <a href="/datahub/board/" style="display: inline-block; padding: 10px 20px;
           background: #3b82f6; color: white; text-decoration: none;
           border-radius: 4px;">â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>
</body>
</html>
